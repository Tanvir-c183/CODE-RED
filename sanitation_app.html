<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SwachhAI ‚Äì Smart Sanitation Monitor</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --card: #1a2236;
    --border: #2a3550;
    --accent: #00e5c3;
    --accent2: #ff6b35;
    --accent3: #a78bfa;
    --text: #e8eaf0;
    --muted: #6b7a99;
    --grade-a: #00e5c3;
    --grade-b: #60d394;
    --grade-c: #ffd166;
    --grade-d: #ff6b6b;
    --font-display: 'Syne', sans-serif;
    --font-mono: 'Space Mono', monospace;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-display);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
  nav {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
  }

  .logo {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--accent);
    letter-spacing: -0.5px;
  }
  .logo span { color: var(--text); }

  .nav-tabs {
    display: flex;
    gap: 4px;
  }

  .nav-tab {
    padding: 6px 14px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--muted);
    font-family: var(--font-display);
    font-size: 0.82rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .nav-tab:hover { color: var(--text); background: var(--card); }
  .nav-tab.active { background: var(--accent); color: #0a0e1a; }

  /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
  .screen { display: none; padding: 28px 24px; max-width: 1100px; margin: 0 auto; animation: fadeIn 0.35s ease; }
  .screen.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ */
  h1 { font-size: 2.2rem; font-weight: 800; line-height: 1.1; }
  h2 { font-size: 1.4rem; font-weight: 700; }
  h3 { font-size: 1rem; font-weight: 700; }
  .tag {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    font-family: var(--font-mono);
  }
  .tag-green { background: rgba(0,229,195,0.15); color: var(--accent); border: 1px solid rgba(0,229,195,0.3); }
  .tag-orange { background: rgba(255,107,53,0.15); color: var(--accent2); border: 1px solid rgba(255,107,53,0.3); }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
  }
  .card-sm { padding: 14px 18px; }

  /* ‚îÄ‚îÄ GRADE BADGE ‚îÄ‚îÄ */
  .grade-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 52px; height: 52px;
    border-radius: 12px;
    font-size: 1.6rem;
    font-weight: 800;
    font-family: var(--font-mono);
    flex-shrink: 0;
  }
  .grade-A { background: rgba(0,229,195,0.15); color: var(--grade-a); border: 2px solid var(--grade-a); }
  .grade-B { background: rgba(96,211,148,0.15); color: var(--grade-b); border: 2px solid var(--grade-b); }
  .grade-C { background: rgba(255,209,102,0.15); color: var(--grade-c); border: 2px solid var(--grade-c); }
  .grade-D { background: rgba(255,107,107,0.15); color: var(--grade-d); border: 2px solid var(--grade-d); }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn {
    padding: 10px 22px;
    border-radius: 10px;
    border: none;
    font-family: var(--font-display);
    font-weight: 700;
    font-size: 0.88rem;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .btn-primary { background: var(--accent); color: #0a0e1a; }
  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,229,195,0.3); }
  .btn-secondary { background: var(--card); color: var(--text); border: 1px solid var(--border); }
  .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
  .btn-danger { background: rgba(255,107,107,0.15); color: var(--grade-d); border: 1px solid var(--grade-d); }

  /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
  .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }

  /* ‚îÄ‚îÄ HOME SCREEN ‚îÄ‚îÄ */
  .hero {
    background: linear-gradient(135deg, #111827 0%, #1a2236 50%, #0f1c2e 100%);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 48px 40px;
    margin-bottom: 28px;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    top: -60px; right: -60px;
    width: 300px; height: 300px;
    background: radial-gradient(circle, rgba(0,229,195,0.08) 0%, transparent 70%);
  }
  .hero-subtitle { color: var(--muted); font-size: 1rem; margin-top: 10px; margin-bottom: 28px; font-weight: 400; }
  .hero-stats { display: flex; gap: 32px; margin-top: 28px; }
  .stat-item { display: flex; flex-direction: column; }
  .stat-num { font-size: 1.8rem; font-weight: 800; color: var(--accent); font-family: var(--font-mono); }
  .stat-label { font-size: 0.75rem; color: var(--muted); font-weight: 600; margin-top: 2px; }

  .toilet-list { display: flex; flex-direction: column; gap: 12px; }
  .toilet-item {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px 18px;
    display: flex;
    align-items: center;
    gap: 16px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .toilet-item:hover { border-color: var(--accent); transform: translateX(4px); }
  .toilet-info { flex: 1; }
  .toilet-name { font-weight: 700; font-size: 0.95rem; }
  .toilet-meta { display: flex; gap: 12px; margin-top: 4px; align-items: center; }
  .toilet-dist { font-size: 0.78rem; color: var(--muted); font-family: var(--font-mono); }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; display: inline-block; }
  .status-open { background: var(--grade-a); box-shadow: 0 0 6px var(--grade-a); }
  .status-closed { background: var(--grade-d); }
  .status-text { font-size: 0.75rem; }
  .toilet-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
  .score-bar-bg { width: 80px; height: 5px; background: var(--border); border-radius: 3px; }
  .score-bar-fill { height: 5px; border-radius: 3px; transition: width 0.6s ease; }

  /* ‚îÄ‚îÄ UPLOAD SCREEN ‚îÄ‚îÄ */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: 20px;
    padding: 60px 40px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: var(--card);
    position: relative;
  }
  .upload-zone:hover, .upload-zone.dragging {
    border-color: var(--accent);
    background: rgba(0,229,195,0.04);
  }
  .upload-icon { font-size: 3rem; margin-bottom: 16px; }
  .upload-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 8px; }
  .upload-sub { color: var(--muted); font-size: 0.85rem; }
  #fileInput { display: none; }
  .preview-img { width: 100%; max-height: 300px; object-fit: cover; border-radius: 16px; margin-top: 16px; }

  /* ‚îÄ‚îÄ ANALYZE RESULT ‚îÄ‚îÄ */
  .result-grade-big {
    width: 120px; height: 120px;
    border-radius: 24px;
    display: flex; align-items: center; justify-content: center;
    font-size: 4rem; font-weight: 800;
    font-family: var(--font-mono);
    margin: 0 auto 20px;
    position: relative;
  }
  .result-grade-big.A { background: rgba(0,229,195,0.1); color: var(--grade-a); border: 3px solid var(--grade-a); box-shadow: 0 0 40px rgba(0,229,195,0.2); }
  .result-grade-big.B { background: rgba(96,211,148,0.1); color: var(--grade-b); border: 3px solid var(--grade-b); box-shadow: 0 0 40px rgba(96,211,148,0.2); }
  .result-grade-big.C { background: rgba(255,209,102,0.1); color: var(--grade-c); border: 3px solid var(--grade-c); box-shadow: 0 0 40px rgba(255,209,102,0.2); }
  .result-grade-big.D { background: rgba(255,107,107,0.1); color: var(--grade-d); border: 3px solid var(--grade-d); box-shadow: 0 0 40px rgba(255,107,107,0.2); }

  .param-row { display: flex; align-items: center; gap: 14px; padding: 10px 0; border-bottom: 1px solid var(--border); }
  .param-row:last-child { border-bottom: none; }
  .param-name { width: 160px; font-size: 0.85rem; font-weight: 600; }
  .param-bar-bg { flex: 1; height: 8px; background: var(--border); border-radius: 4px; }
  .param-bar-fill { height: 8px; border-radius: 4px; }
  .param-score { width: 40px; text-align: right; font-family: var(--font-mono); font-size: 0.82rem; font-weight: 700; }

  /* ‚îÄ‚îÄ MAP SCREEN ‚îÄ‚îÄ */
  #map { height: 420px; border-radius: 16px; border: 1px solid var(--border); }
  .leaflet-popup-content-wrapper {
    background: var(--card) !important;
    border: 1px solid var(--border) !important;
    color: var(--text) !important;
    border-radius: 12px !important;
    font-family: var(--font-display) !important;
  }
  .leaflet-popup-tip { background: var(--card) !important; }

  .filter-bar { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 16px; }
  .filter-chip {
    padding: 5px 14px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--muted);
    font-size: 0.78rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .filter-chip.active { border-color: var(--accent); color: var(--accent); background: rgba(0,229,195,0.08); }

  /* ‚îÄ‚îÄ ADMIN SCREEN ‚îÄ‚îÄ */
  .stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .stat-card-label { font-size: 0.75rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
  .stat-card-num { font-size: 2rem; font-weight: 800; font-family: var(--font-mono); }
  .stat-card-sub { font-size: 0.75rem; color: var(--muted); }

  .admin-table { width: 100%; border-collapse: collapse; }
  .admin-table th {
    text-align: left; padding: 10px 14px;
    font-size: 0.72rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px;
    color: var(--muted); border-bottom: 1px solid var(--border);
  }
  .admin-table td { padding: 12px 14px; border-bottom: 1px solid var(--border); font-size: 0.88rem; }
  .admin-table tr:last-child td { border-bottom: none; }
  .admin-table tr:hover td { background: rgba(255,255,255,0.02); }

  .alert-item {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 16px;
    border-radius: 10px;
    border-left: 3px solid var(--grade-d);
    background: rgba(255,107,107,0.06);
    margin-bottom: 10px;
  }
  .alert-icon { font-size: 1.1rem; }
  .alert-text { flex: 1; font-size: 0.85rem; }
  .alert-time { font-size: 0.75rem; color: var(--muted); font-family: var(--font-mono); }

  /* ‚îÄ‚îÄ DISPLAY MODE ‚îÄ‚îÄ */
  #displayScreen {
    background: var(--bg);
    min-height: calc(100vh - 60px);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px;
  }
  #displayScreen.active {
    display: flex;
  }
  .display-grade {
    font-size: 14rem;
    font-weight: 800;
    font-family: var(--font-mono);
    line-height: 1;
    margin: 20px 0;
    filter: drop-shadow(0 0 60px currentColor);
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.85; } }
  .display-title { font-size: 2rem; font-weight: 800; margin-bottom: 8px; }
  .display-sub { font-size: 1rem; color: var(--muted); }
  .display-score { font-family: var(--font-mono); font-size: 1.2rem; margin-top: 16px; }
  .display-footer { margin-top: 40px; display: flex; gap: 40px; justify-content: center; }
  .display-info { display: flex; flex-direction: column; align-items: center; gap: 4px; }
  .display-info-label { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
  .display-info-val { font-size: 1rem; font-weight: 700; }

  /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
  .loading-overlay {
    position: fixed; inset: 0;
    background: rgba(10,14,26,0.9);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 999;
    display: none;
  }
  .loading-overlay.active { display: flex; }
  .spinner {
    width: 48px; height: 48px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-bottom: 20px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-size: 0.9rem; color: var(--muted); font-family: var(--font-mono); }

  /* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
  .progress-steps { display: flex; gap: 8px; margin-bottom: 24px; align-items: center; }
  .step { display: flex; align-items: center; gap: 6px; }
  .step-dot { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.72rem; font-weight: 700; font-family: var(--font-mono); }
  .step-dot.done { background: var(--accent); color: #0a0e1a; }
  .step-dot.current { background: rgba(0,229,195,0.15); color: var(--accent); border: 2px solid var(--accent); }
  .step-dot.todo { background: var(--border); color: var(--muted); }
  .step-line { flex: 1; height: 2px; background: var(--border); min-width: 24px; }
  .step-line.done { background: var(--accent); }
  .step-label { font-size: 0.7rem; color: var(--muted); }

  /* Responsive */
  @media (max-width: 680px) {
    .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
    h1 { font-size: 1.6rem; }
    .hero { padding: 28px 20px; }
    .hero-stats { flex-wrap: wrap; gap: 16px; }
    nav { padding: 0 12px; }
    .nav-tab { padding: 5px 10px; font-size: 0.75rem; }
    .display-grade { font-size: 8rem; }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo">Swachh<span>AI</span></div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showScreen('home')">üè† Home</button>
    <button class="nav-tab" onclick="showScreen('analyze')">üì∏ Analyze</button>
    <button class="nav-tab" onclick="showScreen('map')">üó∫Ô∏è Map</button>
    <button class="nav-tab" onclick="showScreen('admin')">‚öôÔ∏è Admin</button>
    <button class="nav-tab" onclick="showScreen('display')">üì∫ Display</button>
  </div>
</nav>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
  <div class="loading-text" id="loadingText">AI analyzing image...</div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HOME SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="screen active" id="screen-home">
  <div class="hero">
    <div class="tag tag-green" style="margin-bottom: 16px;">Maharashtra ‚Ä¢ SDG 6</div>
    <h1>Smart Sanitation<br/>Monitor</h1>
    <p class="hero-subtitle">AI-powered real-time cleanliness monitoring for public toilets. Find the cleanest facility near you.</p>
    <div style="display:flex; gap:12px; flex-wrap:wrap;">
      <button class="btn btn-primary" onclick="showScreen('analyze')">üì∏ Analyze a Toilet</button>
      <button class="btn btn-secondary" onclick="showScreen('map')">üó∫Ô∏è Find Nearby</button>
    </div>
    <div class="hero-stats">
      <div class="stat-item"><span class="stat-num">24</span><span class="stat-label">Toilets Monitored</span></div>
      <div class="stat-item"><span class="stat-num">8</span><span class="stat-label">Grade A Facilities</span></div>
      <div class="stat-item"><span class="stat-num">3</span><span class="stat-label">Need Attention</span></div>
    </div>
  </div>

  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
    <h2>Nearby Toilets</h2>
    <span class="tag tag-green">üìç Pune, MH</span>
  </div>
  <div class="toilet-list" id="homeToiletList"></div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ANALYZE SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="screen" id="screen-analyze">
  <div style="margin-bottom:24px;">
    <div class="tag tag-green" style="margin-bottom:12px;">AI Analysis</div>
    <h1>Cleanliness Scanner</h1>
    <p style="color:var(--muted); margin-top:8px;">Upload a photo of any public toilet to get an instant AI hygiene grade.</p>
  </div>

  <!-- Step indicator -->
  <div class="progress-steps" id="progressSteps">
    <div class="step">
      <div class="step-dot current" id="step1dot">1</div>
    </div>
    <div class="step-line" id="line1"></div>
    <div class="step">
      <div class="step-dot todo" id="step2dot">2</div>
    </div>
    <div class="step-line" id="line2"></div>
    <div class="step">
      <div class="step-dot todo" id="step3dot">3</div>
    </div>
    <div style="font-size:0.75rem; color:var(--muted); margin-left:8px;">Upload ‚Üí Analyze ‚Üí Result</div>
  </div>

  <!-- Upload panel -->
  <div id="uploadPanel">
    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
      <div class="upload-icon">üì∑</div>
      <div class="upload-title">Upload Toilet Photo</div>
      <div class="upload-sub">Click to select image or drag & drop here<br/>(JPG, PNG supported)</div>
      <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)" />
    </div>
    <div style="margin-top:16px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
      <button class="btn btn-secondary" onclick="useMockImage('clean')">‚úÖ Try: Clean Toilet</button>
      <button class="btn btn-secondary" onclick="useMockImage('dirty')">üö´ Try: Dirty Toilet</button>
      <button class="btn btn-secondary" onclick="useMockImage('medium')">‚ö†Ô∏è Try: Average</button>
    </div>
  </div>

  <!-- Preview + analyze -->
  <div id="previewPanel" style="display:none;">
    <img id="previewImg" class="preview-img" alt="Uploaded image" />
    <div style="display:flex; gap:10px; margin-top:16px; justify-content:center;">
      <button class="btn btn-primary" onclick="analyzeImage()">ü§ñ Analyze with AI</button>
      <button class="btn btn-secondary" onclick="resetUpload()">‚Ü© Upload Again</button>
    </div>
  </div>

  <!-- Result panel -->
  <div id="resultPanel" style="display:none;">
    <div class="grid-2" style="gap:20px; margin-top:8px;">
      <div class="card" style="text-align:center;">
        <p style="font-size:0.78rem; color:var(--muted); font-weight:700; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:16px;">Hygiene Grade</p>
        <div class="result-grade-big" id="resultGradeBig">A</div>
        <div id="resultScoreText" style="font-family:var(--font-mono); font-size:1.5rem; font-weight:700; margin-bottom:8px;"></div>
        <div id="resultMessage" style="font-size:0.85rem; color:var(--muted); line-height:1.4;"></div>
        <div style="margin-top:20px; display:flex; flex-direction:column; gap:8px;">
          <button class="btn btn-primary" style="width:100%; justify-content:center;" onclick="showScreen('display')">üì∫ View Public Display</button>
          <button class="btn btn-secondary" style="width:100%; justify-content:center;" onclick="showScreen('map')">üó∫Ô∏è Find Better Nearby</button>
        </div>
      </div>
      <div class="card">
        <h3 style="margin-bottom:16px;">Parameter Breakdown</h3>
        <div id="paramBreakdown"></div>
        <div style="margin-top:16px; padding:12px; background:var(--surface); border-radius:10px;">
          <div style="font-size:0.75rem; color:var(--muted); margin-bottom:4px;">AI RECOMMENDATION</div>
          <div id="aiRecommendation" style="font-size:0.85rem; line-height:1.5;"></div>
        </div>
      </div>
    </div>
    <div style="margin-top:16px; text-align:center;">
      <button class="btn btn-secondary" onclick="resetUpload()">üì∏ Analyze Another</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAP SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="screen" id="screen-map">
  <div style="margin-bottom:20px;">
    <div class="tag tag-green" style="margin-bottom:12px;">Live Map</div>
    <h1>Find Nearby Toilets</h1>
    <p style="color:var(--muted); margin-top:8px;">Showing public sanitation facilities within 2km radius.</p>
  </div>
  <div class="filter-bar">
    <span style="font-size:0.8rem; color:var(--muted); font-weight:700;">Filter:</span>
    <button class="filter-chip active" onclick="filterMap('all', this)">All</button>
    <button class="filter-chip" onclick="filterMap('A', this)">Grade A Only</button>
    <button class="filter-chip" onclick="filterMap('open', this)">Open Now</button>
    <button class="filter-chip" onclick="filterMap('female', this)">Female-Only</button>
  </div>
  <div id="map"></div>
  <div style="margin-top:20px;">
    <h3 style="margin-bottom:12px;">All Facilities</h3>
    <div class="toilet-list" id="mapToiletList"></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ADMIN SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="screen" id="screen-admin">
  <div style="margin-bottom:24px;">
    <div class="tag tag-orange" style="margin-bottom:12px;">Admin Dashboard</div>
    <h1>Municipal Control Panel</h1>
    <p style="color:var(--muted); margin-top:8px;">PMC / BMC Officer View ‚Äì Real-time monitoring & alerts.</p>
  </div>

  <div class="grid-4" style="margin-bottom:24px;">
    <div class="stat-card">
      <span class="stat-card-label">Total Toilets</span>
      <span class="stat-card-num" style="color:var(--accent);">24</span>
      <span class="stat-card-sub">Across Pune</span>
    </div>
    <div class="stat-card">
      <span class="stat-card-label">Grade A/B</span>
      <span class="stat-card-num" style="color:var(--grade-b);">14</span>
      <span class="stat-card-sub">Good condition</span>
    </div>
    <div class="stat-card">
      <span class="stat-card-label">Need Cleaning</span>
      <span class="stat-card-num" style="color:var(--grade-d);">3</span>
      <span class="stat-card-sub">Grade D detected</span>
    </div>
    <div class="stat-card">
      <span class="stat-card-label">Avg Score</span>
      <span class="stat-card-num" style="color:var(--accent3);">72</span>
      <span class="stat-card-sub">out of 100</span>
    </div>
  </div>

  <div class="grid-2" style="gap:20px;">
    <div class="card">
      <h3 style="margin-bottom:16px;">üö® Active Alerts</h3>
      <div id="alertsList"></div>
    </div>
    <div class="card">
      <h3 style="margin-bottom:16px;">üìä Grade Distribution</h3>
      <div id="gradeChart"></div>
    </div>
  </div>

  <div class="card" style="margin-top:20px;">
    <h3 style="margin-bottom:16px;">All Facilities</h3>
    <table class="admin-table">
      <thead>
        <tr>
          <th>Facility Name</th>
          <th>Grade</th>
          <th>Score</th>
          <th>Status</th>
          <th>Last Cleaned</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="adminTableBody"></tbody>
    </table>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DISPLAY SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="screen" id="screen-display">
  <div style="margin-bottom:24px; display:flex; justify-content:space-between; align-items:center;">
    <div>
      <div class="tag tag-green" style="margin-bottom:12px;">Public Display Mode</div>
      <h1>Grade Display Simulation</h1>
      <p style="color:var(--muted); margin-top:8px;">This is what the screen outside the toilet shows.</p>
    </div>
    <button class="btn btn-primary" onclick="openFullscreen()">‚õ∂ Full Screen</button>
  </div>

  <div id="displayPreview" style="background:var(--card); border:1px solid var(--border); border-radius:20px; padding:60px 40px; text-align:center; position:relative; overflow:hidden;">
    <div id="displayBg" style="position:absolute; inset:0; opacity:0.05;"></div>
    <div style="font-size:0.8rem; color:var(--muted); letter-spacing:2px; text-transform:uppercase; margin-bottom:8px;">PUNE MUNICIPAL CORPORATION</div>
    <div id="displayFacilityName" style="font-size:1.4rem; font-weight:700; margin-bottom:4px;">FC Road Public Toilet</div>
    <div style="font-size:0.85rem; color:var(--muted); margin-bottom:24px;">Last Updated: <span id="displayLastUpdate"></span></div>

    <div id="displayGradeEl" class="result-grade-big" style="margin:0 auto 24px; width:140px; height:140px; font-size:5rem; border-radius:28px;"></div>

    <div id="displayScoreEl" style="font-family:var(--font-mono); font-size:1.4rem; margin-bottom:8px;"></div>
    <div id="displayMsgEl" style="font-size:1rem; color:var(--muted); margin-bottom:28px;"></div>

    <div style="display:flex; justify-content:center; gap:32px; flex-wrap:wrap;">
      <div><div style="font-size:0.72rem; color:var(--muted); text-transform:uppercase; letter-spacing:1px;">Water</div><div style="font-size:1.2rem; font-weight:700; margin-top:4px;">‚úÖ Available</div></div>
      <div><div style="font-size:0.72rem; color:var(--muted); text-transform:uppercase; letter-spacing:1px;">Status</div><div style="font-size:1.2rem; font-weight:700; margin-top:4px; color:var(--grade-a);">Open</div></div>
      <div><div style="font-size:0.72rem; color:var(--muted); text-transform:uppercase; letter-spacing:1px;">Next Clean</div><div style="font-size:1.2rem; font-weight:700; margin-top:4px;">2:00 PM</div></div>
    </div>
  </div>

  <div style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap;">
    <button class="btn btn-secondary" onclick="setDisplayGrade('A')">Show Grade A</button>
    <button class="btn btn-secondary" onclick="setDisplayGrade('B')">Show Grade B</button>
    <button class="btn btn-secondary" onclick="setDisplayGrade('C')">Show Grade C</button>
    <button class="btn btn-danger" onclick="setDisplayGrade('D')">Show Grade D</button>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TOILETS = [
  { id:1, name:"Shivajinagar Bus Stand Toilet", area:"Shivajinagar", dist:0.3, grade:"A", score:91, lat:18.5308, lng:73.8474, status:"open", female:false, water:true },
  { id:2, name:"FC Road Sulabh Sauchalay",       area:"FC Road",     dist:0.7, grade:"B", score:76, lat:18.5204, lng:73.8567, status:"open", female:false, water:true },
  { id:3, name:"Deccan Gymkhana Public Toilet",   area:"Deccan",      dist:1.1, grade:"C", score:54, lat:18.5176, lng:73.8397, status:"cleaning", female:false, water:true },
  { id:4, name:"JM Road Block 2 Toilet",          area:"JM Road",     dist:1.4, grade:"A", score:88, lat:18.5289, lng:73.8553, status:"open", female:true, water:true },
  { id:5, name:"Paud Road Toilet",                area:"Paud Road",   dist:1.8, grade:"B", score:71, lat:18.5100, lng:73.8300, status:"open", female:false, water:false },
  { id:6, name:"Kothrud Depot Toilet",            area:"Kothrud",     dist:2.0, grade:"D", score:31, lat:18.5080, lng:73.8150, status:"open", female:false, water:true },
];

const MOCK_RESULTS = {
  clean: { grade:"A", score:88, params:{ "Floor Cleanliness":92, "Garbage/Litter":95, "Water Availability":80, "User Comfort":88, "Last Cleaned":82 }, msg:"Excellent condition! This facility is well-maintained.", rec:"No immediate action needed. Schedule routine cleaning at 4:00 PM." },
  dirty: { grade:"D", score:28, params:{ "Floor Cleanliness":18, "Garbage/Litter":22, "Water Availability":45, "User Comfort":20, "Last Cleaned":15 }, msg:"Critical condition. Immediate cleaning required!", rec:"üö® Alert sent to PMC. Dispatch cleaning crew within 30 minutes." },
  medium: { grade:"C", score:56, params:{ "Floor Cleanliness":60, "Garbage/Litter":55, "Water Availability":70, "User Comfort":50, "Last Cleaned":45 }, msg:"Below average. Cleaning recommended soon.", rec:"Schedule priority cleaning within 2 hours. Check water supply." },
};

let currentResult = MOCK_RESULTS.clean;
let mapInstance = null;
let mapMarkers = [];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  const tabs = document.querySelectorAll('.nav-tab');
  const idx = ['home','analyze','map','admin','display'].indexOf(name);
  if (idx >= 0) tabs[idx].classList.add('active');
  if (name === 'map') setTimeout(initMap, 100);
  if (name === 'display') updateDisplay();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HOME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderHomeList() {
  const el = document.getElementById('homeToiletList');
  el.innerHTML = TOILETS.slice(0,4).map(t => toiletItemHTML(t)).join('');
}

function toiletItemHTML(t) {
  const gradeColor = { A:'var(--grade-a)', B:'var(--grade-b)', C:'var(--grade-c)', D:'var(--grade-d)' }[t.grade];
  const statusHtml = t.status === 'open'
    ? `<span class="status-dot status-open"></span><span class="status-text" style="color:var(--grade-a)">Open</span>`
    : `<span class="status-dot status-closed"></span><span class="status-text" style="color:var(--grade-d)">Closed</span>`;
  return `<div class="toilet-item" onclick="showScreen('map')">
    <div class="grade-badge grade-${t.grade}">${t.grade}</div>
    <div class="toilet-info">
      <div class="toilet-name">${t.name}</div>
      <div class="toilet-meta">
        ${statusHtml}
        <span class="toilet-dist">üìç ${t.dist} km</span>
        ${t.female ? '<span class="tag tag-orange" style="font-size:0.65rem;">‚ôÄ Female</span>' : ''}
        ${!t.water ? '<span style="font-size:0.72rem;color:var(--grade-d);">üíß No Water</span>' : ''}
      </div>
    </div>
    <div class="toilet-right">
      <div style="font-family:var(--font-mono); font-size:1rem; font-weight:700; color:${gradeColor}">${t.score}</div>
      <div class="score-bar-bg"><div class="score-bar-fill" style="width:${t.score}%; background:${gradeColor};"></div></div>
    </div>
  </div>`;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ANALYZE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const uploadZone = document.getElementById('uploadZone');
uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('dragging'); });
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragging'));
uploadZone.addEventListener('drop', e => { e.preventDefault(); uploadZone.classList.remove('dragging'); const f = e.dataTransfer.files[0]; if(f) processFile(f); });

function handleFileSelect(e) { const f = e.target.files[0]; if(f) processFile(f); }

function processFile(file) {
  const reader = new FileReader();
  reader.onload = e => {
    document.getElementById('previewImg').src = e.target.result;
    document.getElementById('uploadPanel').style.display = 'none';
    document.getElementById('previewPanel').style.display = 'block';
    document.getElementById('resultPanel').style.display = 'none';
    setStep(2);
  };
  reader.readAsDataURL(file);
}

function useMockImage(type) {
  currentResult = MOCK_RESULTS[type];
  const colors = { clean:'#1a3d2e', dirty:'#3d1a1a', medium:'#3d3020' };
  const emojis = { clean:'üöΩ‚ú®', dirty:'üöΩüíÄ', medium:'üöΩ‚ö†Ô∏è' };
  const fakeImg = `data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='300'><rect width='600' height='300' fill='${encodeURIComponent(colors[type])}'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='80'>${emojis[type]}</text></svg>`;
  document.getElementById('previewImg').src = fakeImg;
  document.getElementById('uploadPanel').style.display = 'none';
  document.getElementById('previewPanel').style.display = 'block';
  document.getElementById('resultPanel').style.display = 'none';
  setStep(2);
}

function setStep(n) {
  [1,2,3].forEach(i => {
    const dot = document.getElementById('step'+i+'dot');
    if(i < n) { dot.className='step-dot done'; dot.textContent='‚úì'; }
    else if(i === n) { dot.className='step-dot current'; dot.textContent=i; }
    else { dot.className='step-dot todo'; dot.textContent=i; }
  });
  if(document.getElementById('line1')) {
    document.getElementById('line1').className = 'step-line' + (n > 1 ? ' done' : '');
    document.getElementById('line2').className = 'step-line' + (n > 2 ? ' done' : '');
  }
}

function analyzeImage() {
  const overlay = document.getElementById('loadingOverlay');
  overlay.classList.add('active');
  const steps = ["Uploading image...", "Running AI model...", "Detecting objects...", "Calculating hygiene score...", "Generating report..."];
  let i = 0;
  const interval = setInterval(() => {
    document.getElementById('loadingText').textContent = steps[i] || steps[steps.length-1];
    i++;
  }, 500);
  setTimeout(() => {
    clearInterval(interval);
    overlay.classList.remove('active');
    showResult();
    setStep(3);
  }, 2800);
}

function showResult() {
  const r = currentResult;
  const gradeEl = document.getElementById('resultGradeBig');
  gradeEl.textContent = r.grade;
  gradeEl.className = 'result-grade-big ' + r.grade;
  document.getElementById('resultScoreText').textContent = r.score + ' / 100';
  document.getElementById('resultScoreText').style.color = gradeColor(r.grade);
  document.getElementById('resultMessage').textContent = r.msg;
  document.getElementById('aiRecommendation').textContent = r.rec;

  const paramColors = { A:'var(--grade-a)', B:'var(--grade-b)', C:'var(--grade-c)', D:'var(--grade-d)' };
  const breakdown = document.getElementById('paramBreakdown');
  breakdown.innerHTML = Object.entries(r.params).map(([name, score]) => {
    const col = score >= 80 ? 'var(--grade-a)' : score >= 60 ? 'var(--grade-b)' : score >= 40 ? 'var(--grade-c)' : 'var(--grade-d)';
    return `<div class="param-row">
      <div class="param-name">${name}</div>
      <div class="param-bar-bg"><div class="param-bar-fill" style="width:${score}%; background:${col};"></div></div>
      <div class="param-score" style="color:${col}">${score}</div>
    </div>`;
  }).join('');

  document.getElementById('previewPanel').style.display = 'none';
  document.getElementById('resultPanel').style.display = 'block';
  updateDisplay();
}

function gradeColor(g) {
  return { A:'var(--grade-a)', B:'var(--grade-b)', C:'var(--grade-c)', D:'var(--grade-d)' }[g];
}

function resetUpload() {
  document.getElementById('uploadPanel').style.display = 'block';
  document.getElementById('previewPanel').style.display = 'none';
  document.getElementById('resultPanel').style.display = 'none';
  document.getElementById('fileInput').value = '';
  setStep(1);
  currentResult = MOCK_RESULTS.clean;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initMap() {
  if(mapInstance) return;
  mapInstance = L.map('map').setView([18.5204, 73.8567], 14);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(mapInstance);

  TOILETS.forEach(t => {
    const col = { A:'#00e5c3', B:'#60d394', C:'#ffd166', D:'#ff6b6b' }[t.grade];
    const icon = L.divIcon({
      className: '',
      html: `<div style="background:${col};color:#0a0e1a;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:1rem;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.4);">${t.grade}</div>`,
      iconSize: [36, 36], iconAnchor: [18, 18]
    });
    const marker = L.marker([t.lat, t.lng], { icon }).addTo(mapInstance);
    marker.bindPopup(`<b style="color:#e8eaf0">${t.name}</b><br/><span style="color:#6b7a99">Grade: <b style="color:${col}">${t.grade}</b> (${t.score}/100)</span><br/><span style="color:#6b7a99">Distance: ${t.dist} km</span><br/><span style="color:#6b7a99">Status: ${t.status === 'open' ? 'üü¢ Open' : 'üî¥ Closed'}</span>`);
    mapMarkers.push({ marker, toilet: t });
  });

  renderMapList(TOILETS);
}

function filterMap(type, btn) {
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  mapMarkers.forEach(({ marker, toilet }) => {
    let show = true;
    if(type === 'A') show = toilet.grade === 'A';
    else if(type === 'open') show = toilet.status === 'open';
    else if(type === 'female') show = toilet.female;
    if(show) marker.addTo(mapInstance);
    else marker.remove();
  });
  const filtered = TOILETS.filter(t => {
    if(type === 'all') return true;
    if(type === 'A') return t.grade === 'A';
    if(type === 'open') return t.status === 'open';
    if(type === 'female') return t.female;
  });
  renderMapList(filtered);
}

function renderMapList(list) {
  document.getElementById('mapToiletList').innerHTML = list.map(t => toiletItemHTML(t)).join('');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ADMIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAdmin() {
  // Alerts
  const alerts = TOILETS.filter(t => t.grade === 'D' || t.grade === 'C');
  document.getElementById('alertsList').innerHTML = alerts.map(t => `
    <div class="alert-item">
      <div class="alert-icon">${t.grade === 'D' ? 'üö®' : '‚ö†Ô∏è'}</div>
      <div class="alert-text"><b>${t.name}</b><br><span style="color:var(--muted);font-size:0.8rem;">Grade ${t.grade} ‚Äì Score: ${t.score}/100 ‚Äì Immediate attention needed</span></div>
      <div class="alert-time">Now</div>
    </div>
  `).join('');

  // Grade chart
  const grades = { A:0, B:0, C:0, D:0 };
  TOILETS.forEach(t => grades[t.grade]++);
  const colors = { A:'var(--grade-a)', B:'var(--grade-b)', C:'var(--grade-c)', D:'var(--grade-d)' };
  document.getElementById('gradeChart').innerHTML = Object.entries(grades).map(([g, count]) => `
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
      <div style="width:28px; height:28px; border-radius:6px; background:${colors[g]}; display:flex; align-items:center; justify-content:center; color:#0a0e1a; font-weight:800; font-size:0.85rem; flex-shrink:0;">${g}</div>
      <div style="flex:1;">
        <div style="background:var(--border); border-radius:4px; height:10px;">
          <div style="background:${colors[g]}; width:${(count/TOILETS.length*100)}%; height:10px; border-radius:4px;"></div>
        </div>
      </div>
      <div style="font-family:var(--font-mono); font-size:0.85rem; font-weight:700; color:${colors[g]}; width:30px; text-align:right;">${count}</div>
    </div>
  `).join('');

  // Table
  document.getElementById('adminTableBody').innerHTML = TOILETS.map(t => {
    const col = { A:'var(--grade-a)', B:'var(--grade-b)', C:'var(--grade-c)', D:'var(--grade-d)' }[t.grade];
    return `<tr>
      <td><b>${t.name}</b><br/><span style="color:var(--muted);font-size:0.75rem;">${t.area}</span></td>
      <td><span style="color:${col}; font-weight:800; font-family:var(--font-mono);">${t.grade}</span></td>
      <td><span style="font-family:var(--font-mono);">${t.score}</span></td>
      <td>${t.status === 'open' ? '<span style="color:var(--grade-a)">‚óè Open</span>' : '<span style="color:var(--grade-c)">‚óè Cleaning</span>'}</td>
      <td style="color:var(--muted); font-size:0.8rem;">Today 10:30 AM</td>
      <td>${t.grade === 'D' ? '<button class="btn btn-danger" style="padding:5px 12px; font-size:0.75rem;">üö® Alert Crew</button>' : '<button class="btn btn-secondary" style="padding:5px 12px; font-size:0.75rem;">üìã Schedule</button>'}</td>
    </tr>`;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DISPLAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateDisplay() {
  const r = currentResult;
  const gradeEl = document.getElementById('displayGradeEl');
  gradeEl.textContent = r.grade;
  gradeEl.className = 'result-grade-big ' + r.grade;
  gradeEl.style.width = '140px'; gradeEl.style.height = '140px'; gradeEl.style.fontSize = '5rem'; gradeEl.style.borderRadius = '28px'; gradeEl.style.margin = '0 auto 24px';
  document.getElementById('displayScoreEl').textContent = 'Score: ' + r.score + '/100';
  document.getElementById('displayScoreEl').style.color = gradeColor(r.grade);
  document.getElementById('displayMsgEl').textContent = r.msg;
  document.getElementById('displayLastUpdate').textContent = new Date().toLocaleTimeString('en-IN', { hour:'2-digit', minute:'2-digit' });
}

function setDisplayGrade(g) {
  const fakeResults = { A:MOCK_RESULTS.clean, B:{...MOCK_RESULTS.clean, grade:'B', score:74, msg:'Good condition. Maintained well.'}, C:MOCK_RESULTS.medium, D:MOCK_RESULTS.dirty };
  currentResult = fakeResults[g];
  updateDisplay();
}

function openFullscreen() {
  const el = document.getElementById('displayPreview');
  if(el.requestFullscreen) el.requestFullscreen();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
renderHomeList();
renderAdmin();
updateDisplay();
document.getElementById('displayLastUpdate').textContent = new Date().toLocaleTimeString('en-IN', { hour:'2-digit', minute:'2-digit' });
</script>
</body>
</html>
